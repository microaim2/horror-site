<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DO YOU TRUST ME?</title>
<style>
  body{
    margin:0;
    background:#050505;
    color:#eee;
    font-family: Arial, sans-serif;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    min-height:100vh;
    overflow-y:auto;
    overflow-x:hidden;
  }

  .box{
    max-height:90vh;
    overflow-y:auto;
    width:520px;
    padding:20px;
    background:#0d0d0d;
    border:1px solid #ff2a2a;
    box-shadow:0 0 55px rgba(255,0,0,.35);
    position:relative;
    margin-top:32px;
  }

  h1{
    text-align:center;
    color:#ff2a2a;
    letter-spacing:3px;
    margin: 8px 0 14px;
    text-shadow: 0 0 16px rgba(255,42,42,.25);
    user-select:none;
  }

  input, button{
    width:100%;
    padding:10px;
    margin-top:10px;
    background:#000;
    color:#fff;
    border:1px solid #444;
    outline:none;
  }
  input:focus{ border-color:#ff2a2a; }

  button{
    cursor:pointer;
    border-color:#ff2a2a;
    letter-spacing:1px;
  }

  .hidden{ display:none; }

  .question{
    margin-top:15px;
    font-size:18px;
    line-height:1.35;
    min-height:52px;
  }

  .hint{
    margin-top:10px;
    font-size:12px;
    color:#aaa;
    text-align:center;
    user-select:none;
    /* display:none; */
  }

  /* ===== –ú–ò–ì–ê–ù–ò–ï –í–û–ü–†–û–°–ê ===== */
  .flickerQ{
    animation: qflicker .85s steps(2,end) infinite;
    text-shadow: 0 0 14px rgba(255,42,42,.35);
  }
  @keyframes qflicker{
    0%{ opacity:1; transform:translate(0,0); filter:blur(0); }
    35%{ opacity:.22; transform:translate(1px,-1px); filter:blur(.5px); }
    55%{ opacity:1; transform:translate(-1px,1px); filter:blur(0); }
    70%{ opacity:.42; transform:translate(1px,1px); filter:blur(.8px); }
    100%{ opacity:1; transform:translate(0,0); filter:blur(0); }
  }

  /* ===== RED FLASH ===== */
  #flash{
    position:fixed;
    inset:0;
    background:rgba(255,0,0,.92);
    opacity:0;
    pointer-events:none;
    z-index:9998;
  }
  #flash.on{
    animation: flash 0.10s steps(2) infinite;
  }
  @keyframes flash{
    0%{opacity:0}
    50%{opacity:1}
    100%{opacity:0}
  }

  /* ===== SCREAMER ===== */
  #screamer{
    position:fixed;
    inset:0;
    background:#000;
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9999;
    overflow:hidden;
  }
  #screamer.show{ display:flex; }

  #screamer::before{
    content:"";
    position:absolute;
    inset:-20%;
    background: repeating-linear-gradient(
      0deg,
      rgba(255,255,255,.08) 0px,
      rgba(255,255,255,.08) 2px,
      transparent 2px,
      transparent 7px
    );
    opacity:.7;
    animation: scan 0.45s linear infinite;
    mix-blend-mode: screen;
    pointer-events:none;
  }
  @keyframes scan{
    from{ transform: translateY(-12%); }
    to{ transform: translateY(12%); }
  }

  #screamer img{
    width:100vw;
    height:100vh;
    object-fit:cover;
    filter: contrast(1.25) saturate(1.15);
    transform: scale(1.02);
    animation: zoom 0.18s infinite alternate;
  }
  @keyframes zoom{
    from{ transform: scale(1.02); }
    to{ transform: scale(1.08); }
  }

  /* ===== –í–ò–ë–†–ê–¶–ò–Ø –≠–ö–†–ê–ù–ê ===== */
  .shakeScreen{
    animation: shake .12s infinite;
  }
  @keyframes shake{
    0%{ transform: translate(0) }
    25%{ transform: translate(10px,-8px) }
    50%{ transform: translate(-10px,8px) }
    75%{ transform: translate(8px,10px) }
    100%{ transform: translate(0) }
  }

  /* ===== END ===== */
  .final{
    color:#e8d6d6;
    font-size:14px;
    line-height:1.7;
    margin-top:8px;
  }
  .panel{
    border: 1px solid rgba(255,255,255,.08);
    background: rgba(0,0,0,.35);
    border-radius: 14px;
    padding: 14px;
    margin-top: 10px;
  }
  .titleSmall{
    color: rgba(255,255,255,.75);
    letter-spacing:.18em;
    text-transform: uppercase;
    font-size: 12px;
    margin: 0 0 8px;
  }
  .kv{
    display:grid;
    grid-template-columns: 1fr 2fr;
    gap: 6px 10px;
    font-size: 14px;
  }
  .kv b{ color:#fff; font-weight:700; }
  .answers{
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .qa{
    border-left: 3px solid rgba(255,42,42,.55);
    padding-left: 10px;
  }
  .q{
    color: rgba(255,255,255,.82);
    margin:0 0 4px;
  }
  .a{
    color:#ffb6b6;
    margin:0;
    font-weight:700;
  }
  .fadeIn{
    opacity:0;
    transform: translateY(6px);
    animation: fade 0.9s ease forwards;
  }
  @keyframes fade{
    to{ opacity:1; transform: translateY(0); }
  }
  .watch{
    color:#ff2a2a;
    font-weight:900;
    letter-spacing:.12em;
    text-shadow: 0 0 18px rgba(255,42,42,.45);
    animation: blinkRed 0.9s steps(2,end) infinite;
    text-align:center;
    margin: 10px 0 0;
  }
  @keyframes blinkRed{
    0%{ opacity:1; }
    50%{ opacity:.18; }
    100%{ opacity:1; }
  }
</style>
</head>

<body>
<div class="box">
  <div id="reg">
    <h1>WELCOME</h1>
    <input id="name" placeholder="Your name">
    <input id="age" placeholder="Your age">
    <input id="city" placeholder="Your city">
    <button id="enterBtn">ENTER</button>
    <div class="hint">—è –∑–Ω–∞—é, –∫—Ç–æ —Ç—ã</div>
  </div>

  <div id="test" class="hidden">
    <h1>ANSWER</h1>
    <div class="question" id="question"></div>
    <input id="answer" placeholder="type your answer">
    <button id="nextBtn">NEXT</button>
    <div class="hint">—è —Ç–µ–±—è –≤–∏–∂—É</div>
  </div>

  <div id="end" class="hidden">
    <h1>FINAL</h1>
    <div class="final" id="result"></div>
    <button id="resetBtn">RESET</button>
    <div class="hint">C–∞–π—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–µ–±—è.</div>
  </div>
</div>

<div id="flash"></div>

<div id="screamer" aria-hidden="true">
  <!-- —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å –≤ –∫–æ—Ä–Ω–µ —Ä—è–¥–æ–º —Å index.html -->
  <img id="screamerImg" src="screamer.jpg" alt="SCREAMER">
</div>

<audio id="screamSound" preload="auto">
  <source src="scream.mp3" type="audio/mpeg">
</audio>

<script>
/* =========================
   QUESTIONS
========================= */
const questionsPool = [
  "Are you alone right now?",
  "Did you lock the door?",
  "Is the light on in your room?",
  "Do you hear any small sounds?",
  "When was the last time you checked behind you?",
  "What is your biggest fear?",
  "Do you believe in ghosts?",
  "Have you ever felt watched?",
  "What would you do if someone whispered your name?",
  "Do you trust this website?",
  "Why did you continue?",
  "What time is it where you are?",
  "What was the last thing you ate?",
  "What is the nearest object to your hand?",
  "Do you sleep with the door closed?",
  "Have you ever seen a shadow move?",
  "If you heard steps in the corridor, would you look?",
  "Who knows you are here right now?",
  "What app did you open last?",
  "What is your worst memory?",
  "What would you never want to lose?",
  "What is something you hide from people?",
  "Do you think someone is reading this with you?",
  "Describe the last nightmare you remember.",
  "Do you want to stop now?"
];

const TOTAL_QUESTIONS = 14;

function pickRandomQuestions(all, count){
  const copy = [...all];
  for(let i = copy.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }
  return copy.slice(0, count);
}

/* =========================
   DOM
========================= */
const regEl = document.getElementById("reg");
const testEl = document.getElementById("test");
const endEl  = document.getElementById("end");

const nameInput = document.getElementById("name");
const ageInput  = document.getElementById("age");
const cityInput = document.getElementById("city");

const questionEl = document.getElementById("question");
const answerInput = document.getElementById("answer");
const resultEl = document.getElementById("result");

const enterBtn = document.getElementById("enterBtn");
const nextBtn = document.getElementById("nextBtn");
const resetBtn = document.getElementById("resetBtn");

const screamer = document.getElementById("screamer");
const flash = document.getElementById("flash");
const screamSound = document.getElementById("screamSound");
const screamerImg = document.getElementById("screamerImg");

// –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî –ø–æ–∫–∞–∂–µ–º –Ω–∞–¥–ø–∏—Å—å
screamerImg.addEventListener("error", () => {
  screamer.innerHTML = '<div style="color:#fff;font-size:22px;font-weight:900">IMAGE NOT FOUND<br>Check: screamer.jpg</div>';
});

/* =========================
   STATE
========================= */
let user = {};
let answers = [];
let qIndex = 0;
let sessionQuestions = pickRandomQuestions(questionsPool, TOTAL_QUESTIONS);

let screamScheduled = false;
let screamTriggered = false;
let screamTimer = null;

let finalScreamTimer = null;

/* =========================
   MUSIC (WebAudio)
========================= */
let ctx = null;
let musicOn = false;
let musicNodes = null;

function ensureAudio(){
  if(!ctx){
    ctx = new (window.AudioContext || window.webkitAudioContext)();
  }
  if(ctx.state === "suspended"){
    ctx.resume().catch(()=>{});
  }
}

function startTenseMusic(){
  ensureAudio();
  if(musicOn) return;

  const master = ctx.createGain();
  master.gain.value = 0.33;

  const comp = ctx.createDynamicsCompressor();
  comp.threshold.value = -26;
  comp.knee.value = 22;
  comp.ratio.value = 7;
  comp.attack.value = 0.006;
  comp.release.value = 0.12;

  const filter = ctx.createBiquadFilter();
  filter.type = "lowpass";
  filter.frequency.value = 900;
  filter.Q.value = 0.75;

  const lfo = ctx.createOscillator();
  lfo.type = "sine";
  lfo.frequency.value = 0.22;
  const lfoGain = ctx.createGain();
  lfoGain.gain.value = 520;
  lfo.connect(lfoGain);
  lfoGain.connect(filter.frequency);

  const o1 = ctx.createOscillator();
  o1.type = "sawtooth";
  o1.frequency.value = 52;

  const o2 = ctx.createOscillator();
  o2.type = "triangle";
  o2.frequency.value = 68;

  const mix = ctx.createGain();
  mix.gain.value = 0.60;

  o1.connect(mix);
  o2.connect(mix);

  mix.connect(filter);
  filter.connect(comp);
  comp.connect(master);
  master.connect(ctx.destination);

  o1.start();
  o2.start();
  lfo.start();

  const pumpTimer = setInterval(() => {
    if(!musicOn) return;
    const t = Date.now()/1000;
    master.gain.value = 0.28 + 0.12*(0.5 + 0.5*Math.sin(t*2.1));
    filter.frequency.value = 650 + 450*(0.5 + 0.5*Math.sin(t*0.22));
    o2.frequency.value = 64 + 10*(0.5 + 0.5*Math.sin(t*0.14));
    o1.frequency.value = 50 + 6*(0.5 + 0.5*Math.sin(t*0.11));
  }, 50);

  musicNodes = { master, comp, filter, lfo, lfoGain, o1, o2, mix, pumpTimer };
  musicOn = true;
}

/* =========================
   MAX LOUD SCREAM (Audio Gain + tab blink + shake)
========================= */
let screamCtx = null;
let screamGain = null;
let screamSrc = null;

let titleTimer = null;
const baseTitle = document.title;

function stopTabBlink(){
  if(titleTimer){
    clearInterval(titleTimer);
    titleTimer = null;
  }
  document.title = baseTitle;
}

function startTabBlink(ms = 2500){
  stopTabBlink();
  let on = false;
  titleTimer = setInterval(() => {
    document.title = on ? "I SEE YOU" : baseTitle;
    on = !on;
  }, 180);

  setTimeout(() => {
    stopTabBlink();
  }, ms);
}

function initScreamAmp(){
  if(screamCtx) return;
  screamCtx = new (window.AudioContext || window.webkitAudioContext)();
  screamGain = screamCtx.createGain();
  screamGain.gain.value = 3.5; // üî• –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≥—Ä–æ–º–∫–æ –≤–Ω—É—Ç—Ä–∏ –±—Ä–∞—É–∑–µ—Ä–∞
  screamGain.connect(screamCtx.destination);

  // MediaElementSource –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¢–û–õ–¨–ö–û 1 —Ä–∞–∑ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç
  screamSrc = screamCtx.createMediaElementSource(screamSound);
  screamSrc.connect(screamGain);
}

function playScreamMax(){
  try{
    initScreamAmp();
    if(screamCtx.state === "suspended") screamCtx.resume().catch(()=>{});

    screamSound.currentTime = 0;
    screamSound.volume = 1.0;
    const p = screamSound.play();
    if(p) p.catch(()=>{});

    // –≤—Ç–æ—Ä–æ–π —É–¥–∞—Ä (–µ—â—ë —Å—Ç—Ä–∞—à–Ω–µ–µ)
    setTimeout(() => {
      screamSound.currentTime = 0;
      screamSound.play().catch(()=>{});
    }, 120);
  }catch(e){}
}

/* =========================
   FLOW
========================= */
function setQuestion(){
  questionEl.textContent = sessionQuestions[qIndex];
  answerInput.value = "";
  answerInput.focus();

  questionEl.classList.remove("flickerQ");
  void questionEl.offsetWidth;
  questionEl.classList.add("flickerQ");
  setTimeout(() => questionEl.classList.remove("flickerQ"), 1500);
}

function scheduleRandomScreamer(){
  if(screamScheduled) return;
  screamScheduled = true;

  const delay = Math.floor(Math.random() * 14000) + 6000; // 6..20s
  screamTimer = setTimeout(() => {
    if(screamTriggered) return;
    if(!testEl.classList.contains("hidden")) triggerScreamer();
  }, delay);
}

function afterScreamerMessage(questionIndexSnapshot){
  if(testEl.classList.contains("hidden")) return;
  if(qIndex !== questionIndexSnapshot) return;

  const original = sessionQuestions[qIndex];
  questionEl.textContent = "I SEE YOU";
  questionEl.classList.remove("flickerQ");
  void questionEl.offsetWidth;
  questionEl.classList.add("flickerQ");

  setTimeout(() => {
    if(testEl.classList.contains("hidden")) return;
    if(qIndex !== questionIndexSnapshot) return;
    questionEl.textContent = original;
  }, 1000);
}

function hideScreamerOnly(){
  flash.classList.remove("on");
  screamer.classList.remove("show");
  screamer.setAttribute("aria-hidden", "true");
  document.body.classList.remove("shakeScreen");
  stopTabBlink();
}

function showScreamerOverlay(){
  flash.classList.add("on");
  screamer.classList.add("show");
  screamer.setAttribute("aria-hidden", "false");

  // –≤–∏–±—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ + –º–æ—Ä–≥–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏
  document.body.classList.add("shakeScreen");
  startTabBlink(2800);

  // –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫—Ä–∏–∫
  playScreamMax();

  setTimeout(() => flash.classList.remove("on"), 1200);
  setTimeout(() => hideScreamerOnly(), 2500);
}

function triggerScreamer(){
  screamTriggered = true;
  const snapshot = qIndex;

  showScreamerOverlay();
  setTimeout(() => afterScreamerMessage(snapshot), 900);
}

function startTest(){
  user.name = nameInput.value.trim();
  user.age  = ageInput.value.trim();
  user.city = cityInput.value.trim();

  if(!user.name || !user.age || !user.city){
    alert("Fill everything.");
    return;
  }

  sessionQuestions = pickRandomQuestions(questionsPool, TOTAL_QUESTIONS);
  answers = [];
  qIndex = 0;
  screamScheduled = false;
  screamTriggered = false;

  regEl.classList.add("hidden");
  testEl.classList.remove("hidden");

  startTenseMusic();

  // ‚Äú—Ä–∞–∑–±—É–¥–∏–º‚Äù audio –∏ —É—Å–∏–ª–∏—Ç–µ–ª—å –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ ENTER
  try{
    initScreamAmp();
    if(screamCtx.state === "suspended") screamCtx.resume().catch(()=>{});
    screamSound.volume = 0;
    screamSound.play().then(()=>{
      screamSound.pause();
      screamSound.currentTime = 0;
      screamSound.volume = 1.0;
    }).catch(()=>{});
  }catch(e){}

  scheduleRandomScreamer();
  setQuestion();
}

function nextQuestion(){
  const a = answerInput.value.trim();
  if(!a){
    alert("Answer.");
    return;
  }

  answers.push({ q: sessionQuestions[qIndex], a });
  qIndex++;

  if(qIndex < sessionQuestions.length){
    setQuestion();
  } else {
    finish();
  }
}

function finish(){
  testEl.classList.add("hidden");
  endEl.classList.remove("hidden");

  const time = new Date().toLocaleTimeString();
  const safeName = escapeHtml(user.name);
  const safeAge  = escapeHtml(user.age);
  const safeCity = escapeHtml(user.city);

  const qaHtml = answers.map((x, idx) => `
    <div class="qa fadeIn" style="animation-delay:${(idx*0.06 + 0.9).toFixed(2)}s">
      <p class="q"><b>${idx+1}.</b> ${escapeHtml(x.q)}</p>
      <p class="a">‚Äî ${escapeHtml(x.a)}</p>
    </div>
  `).join("");

  resultEl.innerHTML = `
    <div class="panel fadeIn" style="animation-delay:.10s">
      <div class="titleSmall">FINAL RECORD ‚Äî ${escapeHtml(time)}</div>
      <div>
        –¢—ã –¥—É–º–∞–ª(–∞), —á—Ç–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–∞–π—Ç.<br>
        –ù–æ —Å–∞–π—Ç ‚Äî —ç—Ç–æ –¥–≤–µ—Ä—å.<br>
        –ê —Ç—ã —Å–∞–º(–∞) –Ω–∞–∂–∞–ª(–∞) –Ω–∞ —Ä—É—á–∫—É.
      </div>
    </div>

    <div class="panel fadeIn" style="animation-delay:.35s">
      <div class="titleSmall">–°–Ω–∞—á–∞–ª–∞ —Ç—ã –æ—Å—Ç–∞–≤–∏–ª(–∞) –ø—Ä–æ—Å—Ç–æ–µ</div>
      <div class="kv">
        <div>–ò–º—è:</div><div><b>${safeName}</b></div>
        <div>–í–æ–∑—Ä–∞—Å—Ç:</div><div><b>${safeAge}</b></div>
        <div>–ì–æ—Ä–æ–¥:</div><div><b>${safeCity}</b></div>
      </div>
    </div>

    <div class="panel fadeIn" style="animation-delay:.60s">
      <div class="titleSmall">–ü–æ—Ç–æ–º —Ç—ã –Ω–∞—á–∞–ª(–∞) –æ—Ç–≤–µ—á–∞—Ç—å</div>
      <div>
        –ò –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç ‚Äî –∫–∞–∫ —à–∞–≥ –ø–æ –∫–æ—Ä–∏–¥–æ—Ä—É, –≥–¥–µ –Ω–µ –≥–æ—Ä–∏—Ç —Å–≤–µ—Ç.<br>
        –¢—ã —Å–ª—ã—à–∏—à—å —Ç–æ–ª—å–∫–æ —Å–≤–æ—ë –¥—ã—Ö–∞–Ω–∏–µ‚Ä¶ –∏ <b>—á—å—ë-—Ç–æ –µ—â—ë</b>.
      </div>
    </div>

    <div class="panel">
      <div class="titleSmall fadeIn" style="animation-delay:.85s">–¢–í–û–ò –û–¢–í–ï–¢–´</div>
      <div class="answers">${qaHtml}</div>
    </div>

    <div class="panel fadeIn" style="animation-delay:${(answers.length*0.06 + 1.25).toFixed(2)}s">
      <div class="titleSmall">–ò –≤–æ—Ç —á—Ç–æ —Å—Ç—Ä–∞—à–Ω–æ</div>
      <div>
        –¢—ã –¥—É–º–∞–µ—à—å, —á—Ç–æ –æ—Ç–≤–µ—Ç—ã –∏—Å—á–µ–∑–∞—é—Ç.<br>
        –ù–æ –æ–Ω–∏ <b>–æ—Å—Ç–∞—é—Ç—Å—è</b>.<br><br>
        –ï—Å–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ —á—Ç–æ-—Ç–æ —â—ë–ª–∫–Ω–µ—Ç ‚Äî –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–π.<br>
        –ï—Å–ª–∏ —ç–∫—Ä–∞–Ω –º–æ—Ä–≥–Ω—ë—Ç ‚Äî –Ω–µ —Å–º–æ—Ç—Ä–∏ –≤ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ.
      </div>
      <div class="watch">WE ARE WATCHING YOU</div>
    </div>
  `;

  const finalDelay = Math.floor(Math.random() * 3000) + 7000; // 7..10s
  clearTimeout(finalScreamTimer);
  finalScreamTimer = setTimeout(() => {
    showScreamerOverlay();
  }, finalDelay);
}

function fakeReset(){
  alert("TOO LATE");
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =========================
   EVENTS
========================= */
enterBtn.addEventListener("click", startTest);
nextBtn.addEventListener("click", nextQuestion);
resetBtn.addEventListener("click", fakeReset);

document.addEventListener("keydown", (e) => {
  if(e.key === "Enter"){
    if(!regEl.classList.contains("hidden")) startTest();
    else if(!testEl.classList.contains("hidden")) nextQuestion();
  }
  if(e.key === "Escape"){
    hideScreamerOnly(); // –º—É–∑—ã–∫–∞ –ù–ï –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è
  }
});

screamer.addEventListener("click", hideScreamerOnly);
</script>
</body>
</html>

